{% extends "layout.html" %}
{% block content %}

<h2>
    {% if diagnosis_categorization %} Edit Diagnosis Categorization {% else %} Add New Diagnosis Categorization {% endif %}
</h2>

<form method="POST"
      action="{% if diagnosis_categorization %}/diagnosis_categorization/{{ diagnosis_categorization.diagnosis_categorization_id }}/edit{% else %}/diagnosis_categorization/new{% endif %}"
      class="mt-4">

    <!-- Diagnosis Foreign Key (Searchable Dropdown) -->
    <div class="mb-3">
        <label class="form-label">Diagnosis *</label>
        <select id="diagnosis_select" name="diagnosis_id" class="form-select" required>
            <option value="">-- Select Diagnosis --</option>
            {% for diagnosis in diagnoses %}
            <option value="{{ diagnosis.diagnosis_id }}"
                {% if diagnosis_categorization and diagnosis_categorization.diagnosis_id == diagnosis.diagnosis_id %}selected{% endif %}>
                {{ diagnosis.diagnosis }}
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Category Foreign Key (Searchable Dropdown) -->
    <div class="mb-3">
        <label class="form-label">Category *</label>
        <select id="category_select" name="category_id" class="form-select" required>
            <option value="">-- Select Category --</option>
            {% for category in categories %}
            <option value="{{ category.category_id }}"
                {% if diagnosis_categorization and diagnosis_categorization.category_id == category.category_id %}selected{% endif %}>
                {{ category.category }}
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Select2 Initialization -->
    <script>
    $(document).ready(function() {
        $('#diagnosis_select').select2({
            placeholder: "Select or search a diagnosis...",
            allowClear: true,
            width: '100%'
        });
        
        $('#category_select').select2({
            placeholder: "Select or search a category...",
            allowClear: true,
            width: '100%'
        });
    });
    </script>

    <button class="btn btn-success">
        {% if diagnosis_categorization %} Save Changes {% else %} Add Diagnosis Categorization {% endif %}
    </button>

    <a href="/diagnosis_categorization" class="btn btn-secondary">Cancel</a>
</form>

{% endblock %}