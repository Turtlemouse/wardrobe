{% extends "layout.html" %}
{% block content %}

<h2>Counselors</h2>

<a href="/counselors/new" class="btn btn-primary mb-3">Add Counselor</a>

<!-- Filter Summary -->
<div class="alert alert-info" id="filterSummary">
    <strong>Showing:</strong> <span id="visibleCount">{{ counselors|length }}</span> of <span id="totalCount">{{ counselors|length }}</span> counselors
    <span id="activeFiltersText"></span>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered" id="counselorsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>SSN</th>
                <th>Email</th>
                <th>Salary</th>
                <th>Highest Degree</th>
                <th>Highest Degree School</th>
                <th>Years Experience</th>
                <th>Years Here</th>
                <th>Specialization</th>
                <th>Active</th>
                <th>Actions</th>
            </tr>
            <tr class="filter-row">
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-0" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 0, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-1" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 1, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-2" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 2, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-3" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 3, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-4" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 4, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-5" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 5, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-6" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 6, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-7" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 7, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-8" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 8, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-9" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 9, this.value)">
                </th>
                <th>
                    <input type="text" 
                           class="form-control form-control-sm" 
                           id="filter-10" 
                           placeholder="Filter..."
                           onkeyup="filterColumn('counselorsTable', 10, this.value)">
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for c in counselors %}
            <tr>
                <td>{{ c.counselor_id }}</td>
                <td>{{ c.name }}</td>
                <td>{{ c.ssn }}</td>
                <td>{{ c.email }}</td>
                <td>{{ c.salary }}</td>
                <td>{{ c.highest_degree }}</td>
                <td>{{ c.highest_degree_school }}</td>
                <td>{{ c.yrs_experience }}</td>
                <td>{{ c.yrs_here }}</td>
                <td>{{ c.specialization }}</td>
                <td>{{ 'Yes' if c.active else 'No' }}</td>
                <td>
                    <a href="/counselors/{{ c.counselor_id }}/edit" class="btn btn-sm btn-warning">Edit</a>
                    <a href="/counselors/{{ c.counselor_id }}/delete" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .filter-row {
        background-color: #f8f9fa;
    }
    
    .filter-row th {
        padding: 5px;
        font-weight: normal;
    }
    
    #filterSummary {
        margin-bottom: 15px;
    }
    
    .filter-badge {
        display: inline-block;
        margin-left: 5px;
        padding: 3px 8px;
        background-color: #0d6efd;
        color: white;
        border-radius: 4px;
        font-size: 0.9em;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
</style>

<script>
let activeFilters = {};
const columnNames = ['ID', 'Name', 'SSN', 'Email', 'Salary', 'Highest Degree', 
                     'Highest Degree School', 'Years Experience', 'Years Here', 
                     'Specialization', 'Active'];

function filterColumn(tableId, columnIndex, filterValue) {
    filterValue = filterValue.toLowerCase().trim();
    
    if (filterValue) {
        activeFilters[columnIndex] = filterValue;
    } else {
        delete activeFilters[columnIndex];
    }
    
    filterTable(tableId);
}

function filterTable(tableId) {
    const table = document.getElementById(tableId);
    const rows = table.querySelectorAll('tbody tr');
    let visibleCount = 0;
    
    rows.forEach(row => {
        let showRow = true;
        
        // Check each active filter
        for (let columnIndex in activeFilters) {
            const cell = row.cells[columnIndex];
            if (cell) {
                const cellText = cell.textContent.toLowerCase().trim();
                const filterValue = activeFilters[columnIndex];
                
                if (!cellText.includes(filterValue)) {
                    showRow = false;
                    break;
                }
            }
        }
        
        row.style.display = showRow ? '' : 'none';
        if (showRow) visibleCount++;
    });
    
    updateFilterSummary(visibleCount, rows.length);
}

function updateFilterSummary(visibleCount, totalCount) {
    document.getElementById('visibleCount').textContent = visibleCount;
    document.getElementById('totalCount').textContent = totalCount;
    
    const activeFiltersText = document.getElementById('activeFiltersText');
    
    if (Object.keys(activeFilters).length > 0) {
        let filterDescriptions = [];
        
        for (let columnIndex in activeFilters) {
            const columnName = columnNames[columnIndex];
            const filterValue = activeFilters[columnIndex];
            filterDescriptions.push(`<span class="filter-badge">${columnName}: "${filterValue}"</span>`);
        }
        
        activeFiltersText.innerHTML = ' | <strong>Active Filters:</strong> ' + filterDescriptions.join(' ');
    } else {
        activeFiltersText.innerHTML = '';
    }
}
</script>

{% endblock %}
