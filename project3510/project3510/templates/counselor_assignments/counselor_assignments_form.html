{% extends "layout.html" %}
{% block content %}

<h2>
    {% if assignment %} Edit Assignment {% else %} New Counselor Assignment {% endif %}
</h2>

<form method="POST"
      action="{% if assignment %}/counselor_assignments/{{ assignment.assignment_id }}/edit{% else %}/counselor_assignments/new{% endif %}"
      class="mt-4">

    <!-- Student -->
    <div class="mb-3">
        <label class="form-label">Student</label>
        <select id="student_select" name="student_id" class="form-select" required>
            <option value="">-- Select Student --</option>

            {% for s in students %}
            <option value="{{ s.student_id }}"
                {% if assignment and assignment.student_id == s.student_id %}selected{% endif %}>
                {{ s.name }} ({{ s.email }})
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Counselor -->
    <div class="mb-3">
        <label class="form-label">Counselor</label>
        <select id="counselor_select" name="counselor_id" class="form-select" required>
            <option value="">-- Select Counselor --</option>

            {% for c in counselors %}
            <option value="{{ c.counselor_id }}"
                {% if assignment and assignment.counselor_id == c.counselor_id %}selected{% endif %}>
                {{ c.name }} ({{ c.email }})
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Start Date -->
    <div class="mb-3">
        <label class="form-label">Start Date</label>
        <input name="start_date" type="date" class="form-control" required
            value="{{ assignment.start_date if assignment else '' }}">
    </div>

    <!-- End Date -->
    <div class="mb-3">
        <label class="form-label">End Date (optional)</label>
        <input name="end_date" type="date" class="form-control"
            value="{{ assignment.end_date if assignment else '' }}">
    </div>

    <!-- Primary assignment -->
    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox"
               name="is_primary" id="is_primary"
               {% if assignment and assignment.is_primary %}checked{% endif %}>
        <label class="form-check-label" for="is_primary">
            Primary Counselor
        </label>
    </div>

    <button class="btn btn-success">
        {% if assignment %} Save Changes {% else %} Add Assignment {% endif %}
    </button>
    <a href="/counselor_assignments" class="btn btn-secondary">Cancel</a>
</form>

<!-- Select2 JS -->
<script>
    $(document).ready(function () {
        $('#student_select').select2({
            placeholder: "Search for a student...",
            width: '100%'
        });

        $('#counselor_select').select2({
            placeholder: "Search for a counselor...",
            width: '100%'
        });
    });
</script>

{% endblock %}
