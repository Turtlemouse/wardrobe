{% extends "layout.html" %}
{% block content %}

<h2>
    {% if tutor_referral %} Edit Tutor Referral {% else %} Add New Tutor Referral {% endif %}
</h2>

<form method="POST"
      action="{% if tutor_referral %}/tutor_referrals/{{ tutor_referral.referral_id }}/edit{% else %}/tutor_referrals/new{% endif %}"
      class="mt-4">

    <!-- Student Foreign Key (Searchable Dropdown) -->
    <div class="mb-3">
        <label class="form-label">Student *</label>
        <select id="student_select" name="student_id" class="form-select" required>
            <option value="">-- Select Student --</option>
            {% for student in students %}
            <option value="{{ student.student_id }}"
                {% if tutor_referral and tutor_referral.student_id == student.student_id %}selected{% endif %}>
                {{ student.name }} ({{ student.email }})
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Date -->
    <div class="mb-3">
        <label class="form-label">Date *</label>
        <input name="date" type="date" class="form-control"
               value="{{ tutor_referral.date if tutor_referral else '' }}" required>
    </div>

    <!-- Tutor Foreign Key (Searchable Dropdown) -->
    <div class="mb-3">
        <label class="form-label">Tutor *</label>
        <select id="tutor_select" name="tutor_id" class="form-select" required>
            <option value="">-- Select Tutor --</option>
            {% for tutor in tutors %}
            <option value="{{ tutor.tutor_id }}"
                {% if tutor_referral and tutor_referral.tutor_id == tutor.tutor_id %}selected{% endif %}>
                {{ tutor.name }} ({{ tutor.specialty if tutor.specialty else 'General' }})
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- Resolution Details -->
    <div class="mb-3">
        <label class="form-label">Resolution Details</label>
        <textarea name="resolution_details" class="form-control" rows="4">{{ tutor_referral.resolution_details if tutor_referral else '' }}</textarea>
    </div>

    <!-- Select2 Initialization -->
    <script>
    $(document).ready(function() {
        $('#student_select').select2({
            placeholder: "Select or search a student...",
            allowClear: true,
            width: '100%'
        });
        
        $('#tutor_select').select2({
            placeholder: "Select or search a tutor...",
            allowClear: true,
            width: '100%'
        });
    });
    </script>

    <button class="btn btn-success">
        {% if tutor_referral %} Save Changes {% else %} Add Tutor Referral {% endif %}
    </button>

    <a href="/tutor_referrals" class="btn btn-secondary">Cancel</a>
</form>

{% endblock %}