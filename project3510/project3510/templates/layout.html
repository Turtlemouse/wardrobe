<!DOCTYPE html>
<html>
<head>
    <title>{{ title or "Dashboard" }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


  </head>

<body>

<!-- Top Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Student Support System</a>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">

        <li class="nav-item">
          <a class="nav-link" href="/">Dashboard</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/peopletab">People</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/visitstab">Visits</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/followupstab">Followups</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/misctab">Misc</a>
        </li>

        

      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="alert alert-danger">
        {% for msg in messages %}
            <p class="mb-0">{{ msg }}</p>
        {% endfor %}
        </div>
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
</div>

</body>

<style>
    /* Prevent layout shift */
    th {
        position: relative;
        white-space: nowrap;
    }
    
    .filter-container {
        display: inline;
    }
    
    .filter-btn {
        cursor: pointer;
        margin-left: 5px;
        font-size: 0.9em;
        color: #6c757d;
        display: inline-block;
        padding: 2px 5px;
    }
    
    .filter-btn:hover {
        color: #0d6efd;
    }
    
    .filter-btn.active {
        color: #0d6efd;
        font-weight: bold;
    }
    
    .filter-input-container {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 5px;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1050;
        min-width: 200px;
        white-space: normal;
    }
    
    .filter-input-container.show {
        display: block;
    }
    
    /* Ensure table header cells don't expand */
    thead th {
        vertical-align: top;
    }
    
    /* Fix any Bootstrap table issues */
    .table > :not(caption) > * > * {
        position: relative;
    }
</style>

<script>
// Filter functionality
let activeFilters = {};

function toggleFilter(columnIndex, headerElement) {
    const filterContainer = headerElement.querySelector('.filter-input-container');
    const isVisible = filterContainer.classList.contains('show');
    
    // Close all other filters
    document.querySelectorAll('.filter-input-container').forEach(fc => {
        fc.classList.remove('show');
    });
    
    // Toggle current filter
    if (!isVisible) {
        filterContainer.classList.add('show');
    }
}

function applyFilter(tableId, columnIndex) {
    const input = document.querySelector(`#filter-${tableId}-${columnIndex}`);
    const filterValue = input.value.toLowerCase().trim();
    
    const filterBtn = input.closest('th').querySelector('.filter-btn');
    
    if (filterValue) {
        activeFilters[columnIndex] = filterValue;
        filterBtn.classList.add('active');
    } else {
        delete activeFilters[columnIndex];
        filterBtn.classList.remove('active');
    }
    
    filterTable(tableId);
    
    // Close the filter popup
    input.closest('.filter-input-container').classList.remove('show');
}

function clearFilter(tableId, columnIndex) {
    const input = document.querySelector(`#filter-${tableId}-${columnIndex}`);
    input.value = '';
    
    const filterBtn = input.closest('th').querySelector('.filter-btn');
    filterBtn.classList.remove('active');
    
    delete activeFilters[columnIndex];
    filterTable(tableId);
    
    // Close the filter popup
    input.closest('.filter-input-container').classList.remove('show');
}

function filterTable(tableId) {
    const table = document.getElementById(tableId);
    const rows = table.querySelectorAll('tbody tr');
    
    rows.forEach(row => {
        let showRow = true;
        
        // Check each active filter
        for (let columnIndex in activeFilters) {
            const cell = row.cells[columnIndex];
            if (cell) {
                const cellText = cell.textContent.toLowerCase().trim();
                const filterValue = activeFilters[columnIndex];
                
                if (!cellText.includes(filterValue)) {
                    showRow = false;
                    break;
                }
            }
        }
        
        row.style.display = showRow ? '' : 'none';
    });
}

// Close filter dropdowns when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('.filter-container')) {
        document.querySelectorAll('.filter-input-container').forEach(fc => {
            fc.classList.remove('show');
        });
    }
});
</script>

</html>
